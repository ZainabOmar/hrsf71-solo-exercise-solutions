<html>
<head>
  <title>GitHub Fetcher</title>
</head>
<body>

<h2>GitHub Fetcher</h2>
<form class="repo-fetcher">
  <h3>Enter a GitHub username to fetch:</h3>
  <input type="text" name="username" />
  <button type="submit">Fetch User's Repos</button>
</form>

<table class="top-repos">
</table>
<script src="https://code.jquery.com/jquery-2.2.0.js"></script>
<script>

// TODO:  
//  Respond to the form's `submit` event,
//  fetch from GitHub's API,
//  and send result to POST /repos/import
$(document).ready(function() {
  $.get('/repos').done(function(data) {
    data.map(function(elem) {
    var url = 'https://github.com/'+elem.owner+'/'+elem.name;
      $('.top-repos').append(
        '<tr><td><a href='+url+'>'+elem.name+'</a></td><td>'+elem.owner+'</td><td>'+elem.stargazers_count+'</td></tr>');
    }) 
  }); 

  function getRepos (user) {
    var clean = null;
    $.get('https://api.github.com/users/'+user+'/repos').done(function(data) {
      clean = data.map(function(elem) {
        var obj = {"name": elem.name,"owner":elem.owner.login, "stargazers_count":elem.stargazers_count};
        return obj;
      });

     for(var i=0; i < clean.length; i++) {
        $.ajax({
          type:'POST',
          url:'/repos/import', 
          data: clean[i],
          success: function(msg) {
            console.log(msg);
          }
        });
      }
    });
  }

  $('form').submit(function(e){
    var name = $('input').val();
    name.length > 0 ? getRepos(name) : alert('Enter A Valid Username');
    e.preventDefault();
  });
});
</script>
</body>
</html>
