<html>
<head>
  <title>GitHub Fetcher</title>
</head>
<body>

<h2>GitHub Fetcher</h2>
<form class="repo-fetcher">
  <h3>Enter a GitHub username to fetch:</h3>
  <input type="text" name="username" />

  <button type="submit">Fetch User's Repos</button>
</form>

<table class="top-repos"></table>

<script src="https://code.jquery.com/jquery-2.2.0.js"></script>
<script>

// TODO:
//  Respond to the form's `submit` event,
//  fetch from GitHub's API,
//  and send result to POST /repos/import
//
 $('.repo-fetcher').submit(function(data) {
   var data = $('input').val()
   event.preventDefault();
   $.ajax({
     url: 'https://api.github.com/users/' + data + '/repos',
     type: 'GET',
     dataType : 'json'

   })
   .done(function(results) {
     window.alert(results.length + " Repos were Imported!");
     results.map(function(result) {
       var info = {
         'name': result.name,
         'owner': result.owner.login,
         'stargazers_count': result.stargazers_count
       }
       $.ajax({
         url: 'http://localhost:4040/repos/import',
         type: 'post',
         data: JSON.stringify(info),
         contentType: 'application/json',
         dataType: 'json'
       })
       location.reload();
     })
   })
 })

 $.ajax({
   url: "http://localhost:4040/repos",
   type: "GET",
   dataType: 'json'
 })
 .done(function(results) {

   results.map(function(result) {
     var url = "https://github.com/" + result.owner + "/" + result.name;
     var name = $("<a href="+ url +"></a>").text("Repo Name: " + result.name);

     var owner = $("<p></p>").text("Owner: " + result.owner);
     var starGazer = $("<p></p>").text("StarGazers: " + result.stargazers_count);

     $('.top-repos').append(name, owner, starGazer);
   })
 })

</script>
</body>
</html>
