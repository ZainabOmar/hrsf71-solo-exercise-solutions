<html>
<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <title>GitHub Fetcher</title>
</head>
<body>

  <h2>GitHub Fetcher</h2>
  <form class="repo-fetcher">
    <h3>Enter a GitHub username to fetch:</h3>
    <input type="text" name="username" />

    <button type="submit">Fetch User's Repos</button>
  </form>

  <table class="top-repos" style="width:70%; border: 1px solid black">
    <tr>
      <th>Name</th>
      <th>Owner</th> 
      <th># of Stargazers</th>
    </tr>

  </table>

  <script src="https://code.jquery.com/jquery-2.2.0.js"></script>
  <script>

  $.ajax({
    type: 'GET',
    url: '/repos',
    contentType: 'application.json',
  })
    .then(function(repos) {
      repos.forEach((repo) => {
        $('table.top-repos').append(
          ('<tr class="repo-row"> <td><a href='+repo.url+'>'+repo.name+'</a></td>' + '<td>' + repo.owner + '</td><td>' + repo.stargazers_count + '</td> </tr>')
        )
      });
    });

  // TODO:
  //  Respond to the form's `submit` event,
  //  fetch from GitHub's API,
  //  and send result to POST /repos/import
  //
  $('.repo-fetcher').submit(function(event) {
    event.preventDefault();
    var form = this;
    var payload = JSON.stringify({
      name: form.username.value
    });
    $.ajax({
    type: 'POST',
    url: '/repos/import',
    contentType: "application/json",
    data: payload,
  })
    .then(() => {
      console.log('Posted repos from user ', $('input').val());
      $.ajax({
        type: 'GET',
        url: '/repos',
        contentType: 'application.json',
      })
        .then(function(repos) {
          $(".repo-row").empty();
          repos.forEach((repo) => {
            $('table.top-repos').append(
              ('<tr class="repo-row"> <td><a href='+repo.url+'>'+repo.name+'</a></td>' + '<td>' + repo.owner + '</td><td>' + repo.stargazers_count + '</td> </tr>')
            )
          });
        })
    })
  })
  
  </script>
</body>
</html>
