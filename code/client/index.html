<html>
<head>
  <title>GitHub Fetcher</title>
</head>
<body>

<h2>GitHub Fetcher</h2>
<form class="repo-fetcher">
  <h3>Enter a GitHub username to fetch:</h3>
  <input id="username" type="text" name="username" />

  <button class="repo-fetcher-btn" type="submit">Fetch User's Repos</button>
</form>

<table class="top-repos"></table>
<script src="https://code.jquery.com/jquery-2.2.0.js"></script>
<script>

// TODO:
//  Respond to the form's `submit` event,
//  fetch from GitHub's API,
//  and send result to POST /repos/import
//
// $('.repo-fetcher')...

$(document).ready(function() {
  $(".repo-fetcher-btn").on('click', function(e) {
    e.preventDefault()
    let input = $('#username').val()
    let inputUrl = "https://api.github.com/users/" + input + "/repos"
    $.ajax({
      headers: {
        Accept: "application/vnd.github.v3+json"
      },
      url: inputUrl,
      dataType: "json",
      crossDomain: true,
      success: function(data) {
        console.log('data', data)
        let convertedData = data.map((item) => { 
            return ({ 
              reponame: item.name,
              username: item.owner.login,
              stargazers: item.stargazers_count
            }
          )
        }) 
        console.log('convertedData::::::', convertedData)
        $.ajax({
          type: "POST",
          url: '/repos/import',
          dataType: "json",
          data: convertedData,
          success: function(response) {
            console.log("response from the server!", response)
          }
        });
      },
      error: function(error) {
        console.log("error", error)
      }
    });


    console.log(input)
  })
})

</script>
</body>
</html>
